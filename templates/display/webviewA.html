<!DOCTYPE html>

{% extends 'baseA.html' %}
{% load static %}
{% block title %}عرض الموقع{% endblock %}
{% block content %}

<head>
    <style>
        .fallback {
            display: none;
            text-align: center;
        }
    </style>
</head>
<body>
    <form action="{% url 'submit_operation' %}" method="post">
        {% csrf_token %}
        <iframe id="myIframe" width="100%" height="500" src="{{ data.full_url }}" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        
        <div id="fallbackContent" class="fallback">
            <h2>انقر على الصورة لتصفح الموقع ثم عد لتقييمه</h2>
            <a href="{{ data.full_url }}" target="_blank" class="btn mt-3 w-100">
                <img src="{% static 'img/advissse.svg' %}" style="width:300px;height:300px">
                {{ data.title }}
            </a>
        </div>

        <input type="hidden" name="url" value="{{ data.full_url }}">
        <input type="hidden" name="title" value="{{ data.title }}">
        <input type="hidden" name="searchtxt" value="{{ data.searchtxt }}">
        {% include 'display/partials/frpbuttons.html' %}
        {% include 'display/partials/savedurl.html' %}
    </form>

    <script>
        const iframe = document.getElementById('myIframe');
        const fallbackContent = document.getElementById('fallbackContent');

        iframe.onload = function() {
            // يتم تنفيذ هذا الكود إذا تم تحميل الـ iframe بنجاح
            console.log('iframe loaded successfully');
        };

        iframe.onerror = function() {
            // يتم تنفيذ هذا الكود إذا فشل تحميل الـ iframe
            console.log('Failed to load iframe content');
            iframe.style.display = 'none';
            fallbackContent.style.display = 'block';
        };

        // هناك طريقة أخرى للتحقق إذا كان iframe يسمح بالتحميل أم لا
        setTimeout(function() {
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                if (!iframeDoc || iframeDoc.location.href === 'about:blank') {
                    throw new Error('iframe content is not accessible');
                }
                console.log('iframe content is accessible');
            } catch (e) {
                console.log('iframe content is not accessible');
                iframe.style.display = 'none';
                fallbackContent.style.display = 'block';
            }
        }, 8000); // انتظر 8 ثوانٍ قبل التحقق
    </script>
</body>

{% endblock %}
